!function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/dist/",n(n.s=4)}([function(t,e,n){var i=n(1);"string"==typeof i&&(i=[[t.i,i,""]]);var r={insert:"head",singleton:!1};n(3)(i,r);i.locals&&(t.exports=i.locals)},function(t,e,n){(t.exports=n(2)(!1)).push([t.i,'body {\n  margin: 0;\n  background: rgb(100, 163, 221);\n}\n\n.gl-canvas-container {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  height: 100vh;\n}\n\n#glCanvas {\n  background: white;\n}\n\n#canvas {\n  display: none;\n}\n\n.control-box-container {\n  top: 0px;\n  left: 0px;\n  position: absolute;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  height: 100vh;\n  width: 100%\n}\n\n#controlBox {\n  margin: 10px auto 0;\n  width: -moz-fit-content;    /* Firefox/Gecko */\n  width: -webkit-fit-content; /* Chrome */\n  background: white;\n  padding: 15px;\n  border-radius: 3px;\n  visibility: visible;\n  opacity: 1;\n  transition: opacity 0.3s linear;\n}\n\n.hide {\n  visibility: hidden !important;\n  opacity: 0 !important;\n  transition: visibility 0s 0.3s, opacity 0.3s linear !important;\n}\n\ninput[type="checkbox"], input[type="radio"]{\n  cursor: pointer;\n  vertical-align: middle;\n  -webkit-appearance: none;\n  appearance: none;\n  background: rgb(198, 198, 199);\n  border: 3px solid black;\n  border-radius: 3px;\n  box-sizing: border-box;\n  position: relative;\n  box-sizing: content-box ;\n  width: 24px;\n  height: 24px;\n  transition: all .3s linear;\n  }\n\ninput[type="checkbox"]:checked, input[type="radio"]:checked{\n   background-color: #2ECC71;\n}\ninput[type="checkbox"]:focus, input[type="radio"]:focus{\n  border: 3px solid rgb(136, 135, 135);\n}\n\nlabel {\n  vertical-align: middle;\n  font-size: 30px;\n}\n\n.source-heading {\n  font-size: 30px;\n}\n\ninput[type=range] {\n  -webkit-appearance: none;\n  margin: 18px 0;\n  width: 100%;\n}\ninput[type=range]:focus {\n  outline: none;\n}\ninput[type=range]::-webkit-slider-runnable-track {\n  width: 100%;\n  height: 8.4px;\n  cursor: pointer;\n  background: rgb(100, 163, 221);\n  border-radius: 1.3px;\n}\n\ninput[type=range]::-webkit-slider-thumb {\n  height: 36px;\n  width: 26px;\n  border-radius: 3px;\n  background: #2ECC71;\n  cursor: pointer;\n  -webkit-appearance: none;\n  margin-top: -14px;\n}\n\ninput[type=range]:focus::-webkit-slider-runnable-track {\n  background: rgb(100, 163, 221);\n}\ninput[type=range]::-moz-range-track {\n  width: 100%;\n  height: 8.4px;\n  cursor: pointer;\n  background:rgb(100, 163, 221);\n  border-radius: 1.3px;\n}\n\ninput[type=range]::-moz-range-thumb {\n  height: 36px;\n  width: 26px;\n  border-radius: 3px;\n  background: #2ECC71;\n  cursor: pointer;\n}\n\ninput[type=range]::-ms-track {\n  width: 100%;\n  height: 8.4px;\n  cursor: pointer;\n  background: transparent;\n  border-color: transparent;\n  border-width: 26px 0;\n  color: transparent;\n}\n\ninput[type=range]::-ms-thumb {\n  height: 36px;\n  width: 26px;\n  border-radius: 3px;\n  background: #2ECC71;\n  cursor: pointer;\n}\n',""])},function(t,e,n){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n=function(t,e){var n=t[1]||"",i=t[3];if(!i)return n;if(e&&"function"==typeof btoa){var r=(s=i,a=btoa(unescape(encodeURIComponent(JSON.stringify(s)))),c="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(a),"/*# ".concat(c," */")),o=i.sources.map((function(t){return"/*# sourceURL=".concat(i.sourceRoot).concat(t," */")}));return[n].concat(o).concat([r]).join("\n")}var s,a,c;return[n].join("\n")}(e,t);return e[2]?"@media ".concat(e[2],"{").concat(n,"}"):n})).join("")},e.i=function(t,n){"string"==typeof t&&(t=[[null,t,""]]);for(var i={},r=0;r<this.length;r++){var o=this[r][0];null!=o&&(i[o]=!0)}for(var s=0;s<t.length;s++){var a=t[s];null!=a[0]&&i[a[0]]||(n&&!a[2]?a[2]=n:n&&(a[2]="(".concat(a[2],") and (").concat(n,")")),e.push(a))}},e}},function(t,e,n){"use strict";var i,r={},o=function(){return void 0===i&&(i=Boolean(window&&document&&document.all&&!window.atob)),i},s=function(){var t={};return function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}t[e]=n}return t[e]}}();function a(t,e){for(var n=[],i={},r=0;r<t.length;r++){var o=t[r],s=e.base?o[0]+e.base:o[0],a={css:o[1],media:o[2],sourceMap:o[3]};i[s]?i[s].parts.push(a):n.push(i[s]={id:s,parts:[a]})}return n}function c(t,e){for(var n=0;n<t.length;n++){var i=t[n],o=r[i.id],s=0;if(o){for(o.refs++;s<o.parts.length;s++)o.parts[s](i.parts[s]);for(;s<i.parts.length;s++)o.parts.push(m(i.parts[s],e))}else{for(var a=[];s<i.parts.length;s++)a.push(m(i.parts[s],e));r[i.id]={id:i.id,refs:1,parts:a}}}}function l(t){var e=document.createElement("style");if(void 0===t.attributes.nonce){var i=n.nc;i&&(t.attributes.nonce=i)}if(Object.keys(t.attributes).forEach((function(n){e.setAttribute(n,t.attributes[n])})),"function"==typeof t.insert)t.insert(e);else{var r=s(t.insert||"head");if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(e)}return e}var h,u=(h=[],function(t,e){return h[t]=e,h.filter(Boolean).join("\n")});function d(t,e,n,i){var r=n?"":i.css;if(t.styleSheet)t.styleSheet.cssText=u(e,r);else{var o=document.createTextNode(r),s=t.childNodes;s[e]&&t.removeChild(s[e]),s.length?t.insertBefore(o,s[e]):t.appendChild(o)}}function f(t,e,n){var i=n.css,r=n.media,o=n.sourceMap;if(r&&t.setAttribute("media",r),o&&btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleSheet)t.styleSheet.cssText=i;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(i))}}var g=null,p=0;function m(t,e){var n,i,r;if(e.singleton){var o=p++;n=g||(g=l(e)),i=d.bind(null,n,o,!1),r=d.bind(null,n,o,!0)}else n=l(e),i=f.bind(null,n,e),r=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(n)};return i(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;i(t=e)}else r()}}t.exports=function(t,e){(e=e||{}).attributes="object"==typeof e.attributes?e.attributes:{},e.singleton||"boolean"==typeof e.singleton||(e.singleton=o());var n=a(t,e);return c(n,e),function(t){for(var i=[],o=0;o<n.length;o++){var s=n[o],l=r[s.id];l&&(l.refs--,i.push(l))}t&&c(a(t,e),e);for(var h=0;h<i.length;h++){var u=i[h];if(0===u.refs){for(var d=0;d<u.parts.length;d++)u.parts[d]();delete r[u.id]}}}}},function(t,e,n){"use strict";n.r(e);const i="\nprecision lowp float;\nuniform sampler2D u_texture;\nvarying vec2 v_texcoord;\nvarying vec3 instanceColors;\n\nvoid main() {\n    float a = texture2D(u_texture, v_texcoord).a;\n    gl_FragColor = vec4(instanceColors, a);\n}\n",r="\nprecision lowp float;\n\nattribute vec2 a_pos;\nattribute vec2 a_texcoord;\nattribute vec2 a_center;\n\nuniform sampler2D u_image;\n\nuniform bool u_hasColor;\nuniform vec2 u_texsize;\nuniform float u_texStep;\nuniform float u_asciiCount;\nuniform float u_charsPerRow;\n\nvarying vec3 instanceColors;\nvarying vec2 v_texcoord;\n\nfloat bitColor(float x, int levels) {\n  float f_levels = float(levels);\n  return floor(x * (f_levels - 1.0) + 1.0) / f_levels;\n}\n\nvoid main() {\n    vec2 clipSpace = a_pos * 2.0 - 1.0;\n    gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);\n    vec4 pixel = texture2D(u_image, a_center);\n    float luminance = 0.2126 * pixel.r + 0.7152 * pixel.g + 0.0722 * pixel.b;\n\n    if (u_hasColor == true) {\n      instanceColors = vec3(\n        bitColor(pixel.r, 8),\n        bitColor(pixel.g, 8),\n        bitColor(pixel.b, 8)\n      );\n    } else {\n      instanceColors = vec3(0, 0, 0);\n    }\n\n\n    float offset = floor(luminance * u_asciiCount);\n\n    float xOffset = mod(offset, u_charsPerRow);\n    float yOffset = (offset - xOffset) / u_charsPerRow;\n\n    v_texcoord = (vec2(xOffset, yOffset) * u_texStep + a_texcoord) / u_texsize;\n}\n";function o(t,e,n){const i=t.createShader(e);return t.shaderSource(i,n),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS)?i:(alert(`An error occurred compiling the ${e} shaders: `+t.getShaderInfoLog(i)),t.deleteShader(i),null)}class s{constructor(t,e){this.textCanvas=t,this.glCanvas=e,this.charsPerRow=20,this.chars=new Array(300).fill(0).map((t,e)=>String.fromCharCode(32+e)),this.gl=e.getContext("webgl"),this.hasColor=!0,this.videoReady=!1,console.log("max permetner ",this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE)),this.setViewport(),this.createTextData(20),this.initProgram(),this.initImageTexture()}setViewport(){this.gl.viewport(0,0,this.glCanvas.width,this.glCanvas.height)}setSize(t){this.createTextData(t),this.setAsciiTexture(),this.createPositionBuffer(),this.setUniforms()}setHasColor(t){this.hasColor=t,this.setUniforms()}createTextData(t){const e=this.textCanvas.getContext("2d"),n=t*Math.ceil((this.chars.length+1)/this.charsPerRow),i=t*this.charsPerRow;this.textCanvas.width=i,this.textCanvas.height=n;const{atlasMap:r,textureData:o}=this.drawTextToCanvas(this.chars,i,n,t),s=this.getCharsInfo(r,t,i,o);console.log(s);const a=this.sortChars(s),c=a.reduce((t,e)=>Math.max(t,s[e].boxHeight),0),l=a.reduce((t,e)=>Math.max(t,s[e].boxWidth),0);this.count=a.length+1,e.clearRect(0,0,i,n),this.textureData=this.drawTextToCanvas(a,i,n,t).textureData,this.boxWidth=l,this.boxHeight=c,this.textureStepSize=t,this.textureHeight=n,this.textureWidth=i}getCharsInfo(t,e,n,i){return Object.keys(t).reduce((r,o)=>{const s=t[o],a=this.getDarkPixelCount(s.x,s.y,e,e,n,i),{boxWidth:c,boxHeight:l}=this.getBoxSize(s.x,s.y,e,e,n,i);return{...r,[o]:{darkness:a,boxWidth:c,boxHeight:l,char:o}}},{})}drawTextToCanvas(t,e,n,i){const r=this.textCanvas.getContext("2d"),o={};var s=0;for(r.fillStyle="black",r.font=`${i}px monospace`,r.textAlign="left",r.textBaseline="top";s<t.length;)for(var a=0;a+i<=n&&s<t.length;a+=i)for(var c=0;c+i<=e&&s<t.length;c+=i)r.fillText(t[s],c,a),o[t[s]]={x:c,y:a},s++;return{atlasMap:o,textureData:new Uint8Array(r.getImageData(0,0,e,n).data)}}sortChars(t){const e=Object.values(t),n=e.map(t=>t.boxWidth),i=e.map(t=>t.boxHeight),r=this.getPercentile(n,90),o=this.getPercentile(i,75);console.log("width threshold: ",r),console.log("height threshold: ",o);const s=e.filter(t=>t.boxWidth<=r&&t.boxHeight<=o&&t.darkness>0);return console.log(s.map(t=>t.char)),s.sort((t,e)=>e.darkness-t.darkness).map(t=>t.char)}getPercentile(t,e){return t.sort((t,e)=>t-e)[Math.floor(e/100*t.length)]}getDarkPixelCount(t,e,n,i,r,o){var s=0;const a=4*t;for(var c=0;c<i;c++){const t=(e+c)*r*4;for(var l=0;l<n;l++){o[4*l+t+3+a]>0&&s++}}return s}getBoxSize(t,e,n,i,r,o){let s=0,a=0;const c=4*t;for(var l=0;l<i;l++){const t=(e+l)*r*4;for(var h=0;h<n;h++){o[4*h+t+3+c]>0&&(a=Math.max(a,l),s=Math.max(s,h))}}return{boxWidth:s,boxHeight:a}}loadImage(t){var e=new Image;e.src=t,e.onload=()=>this.draw(e)}initImageTexture(){const t=this.gl;t.activeTexture(t.TEXTURE0+1),t.bindTexture(t.TEXTURE_2D,this.textures.image),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST);const e=t.RGBA,n=t.RGBA,i=t.UNSIGNED_BYTE,r=new Uint8Array([0,0,0,255]);t.texImage2D(t.TEXTURE_2D,0,e,1,1,0,n,i,r)}loadFrameToTexture(t){const e=this.gl,n=e.RGBA,i=e.RGBA,r=e.UNSIGNED_BYTE;e.activeTexture(e.TEXTURE0+1),e.bindTexture(e.TEXTURE_2D,this.textures.image),e.texImage2D(e.TEXTURE_2D,0,n,i,r,t)}initProgram(){const t=function(t,e,n){const i=o(t,t.VERTEX_SHADER,e),r=o(t,t.FRAGMENT_SHADER,n),s=t.createProgram();return t.attachShader(s,i),t.attachShader(s,r),t.linkProgram(s),t.getProgramParameter(s,t.LINK_STATUS)?s:(alert("Unable to initialize the shader program: "+t.getProgramInfoLog(s)),null)}(this.gl,r,i);this.shaderProgram=t,this.textures={ascii:this.gl.createTexture(),image:this.gl.createTexture()},this.buffers={vertex:this.gl.createBuffer(),texture:this.gl.createBuffer(),center:this.gl.createBuffer()},this.attribLocations={a_pos:this.gl.getAttribLocation(t,"a_pos"),a_center:this.gl.getAttribLocation(t,"a_center"),a_texcoord:this.gl.getAttribLocation(t,"a_texcoord")},this.uniformLocations={u_texsize:this.gl.getUniformLocation(t,"u_texsize"),u_asciiCount:this.gl.getUniformLocation(t,"u_asciiCount"),u_texture:this.gl.getUniformLocation(t,"u_texture"),u_image:this.gl.getUniformLocation(t,"u_image"),u_texStep:this.gl.getUniformLocation(t,"u_texStep"),u_hasColor:this.gl.getUniformLocation(t,"u_hasColor"),u_charsPerRow:this.gl.getUniformLocation(t,"u_charsPerRow")}}createPositionBuffer(){const t=this.boxWidth,e=this.boxHeight,n=Math.floor(this.glCanvas.height/e),i=Math.floor(this.glCanvas.width/t),r=this.buffers.vertex,o=this.buffers.texture,s=this.buffers.center,a=[];var c=[],l=[],h={x:0,y:0};const u=1/i,d=1/n;if(n>1e4||i>1e4)return void console.log("issue with too many counts");for(var f=0;f<n;f++){for(var g=0;g<i;g++){a.push(h.x,h.y,h.x+u,h.y,h.x,h.y+d,h.x+u,h.y,h.x,h.y+d,h.x+u,h.y+d);const n=h.x+u/2,i=h.y+d/2;l.push(n,i,n,i,n,i,n,i,n,i,n,i),c.push(0,0,0+t,0,0,0+e,0+t,0,0,0+e,0+t,0+e),h.x+=u}h.x=0,h.y+=d}const p=this.gl;p.bindBuffer(p.ARRAY_BUFFER,r),p.bufferData(p.ARRAY_BUFFER,new Float32Array(a),p.STATIC_DRAW),r.numItems=a.length/2,p.bindBuffer(p.ARRAY_BUFFER,o),p.bufferData(p.ARRAY_BUFFER,new Float32Array(c),p.STATIC_DRAW),o.numItems=c.length/2,p.bindBuffer(p.ARRAY_BUFFER,s),p.bufferData(p.ARRAY_BUFFER,new Float32Array(l),p.STATIC_DRAW),s.numItems=c.length/2}bindBuffers(){const t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,this.buffers.vertex),t.vertexAttribPointer(this.attribLocations.a_pos,2,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,this.buffers.texture),t.vertexAttribPointer(this.attribLocations.a_texcoord,2,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,this.buffers.center),t.vertexAttribPointer(this.attribLocations.a_center,2,t.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.attribLocations.a_pos),this.gl.enableVertexAttribArray(this.attribLocations.a_texcoord),this.gl.enableVertexAttribArray(this.attribLocations.a_center)}setAsciiTexture(){const t=this.gl;t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.textures.ascii),t.uniform1i(this.uniformLocations.u_texture,0),console.log("textureWidth ",this.textureWidth),console.log("textureHeight ",this.textureHeight),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.textureWidth,this.textureHeight,0,t.RGBA,t.UNSIGNED_BYTE,this.textureData),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)}setUniforms(){this.gl.uniform2f(this.uniformLocations.u_texsize,this.textureWidth,this.textureHeight),this.gl.uniform1f(this.uniformLocations.u_asciiCount,this.count),this.gl.uniform1i(this.uniformLocations.u_image,1),this.gl.uniform1f(this.uniformLocations.u_texStep,this.textureStepSize),this.gl.uniform1i(this.uniformLocations.u_hasColor,this.hasColor),this.gl.uniform1f(this.uniformLocations.u_charsPerRow,this.charsPerRow)}draw(t){this.gl.useProgram(this.shaderProgram),this.drawToCanvas(t),this.loadFrameToTexture(t),this.createPositionBuffer(),this.bindBuffers(),this.setAsciiTexture(),this.setUniforms(),this.drawScene()}pauseVideo(){this.currentPlaybackCallbackId&&(cancelAnimationFrame(this.currentPlaybackCallbackId),console.log("pausing video "),this.currentPlaybackCallbackId=null)}playVideo(t){this.pauseVideo(),this.gl.useProgram(this.shaderProgram),this.createPositionBuffer(),this.bindBuffers(),this.setAsciiTexture(),this.setUniforms(),this.renderVideo(t)}renderVideo(t){this.loadFrameToTexture(t),this.drawScene(),this.currentPlaybackCallbackId=requestAnimationFrame(()=>this.renderVideo(t))}drawScene(){this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.drawArrays(this.gl.TRIANGLES,0,this.buffers.vertex.numItems)}}n(0);const a="simpsons",c="webcam",l="simpsons.mp4",h=2500;class u{constructor(){const t=document.querySelector("#glCanvas");if(this.canvas=t,null===t.getContext("webgl"))return void alert("Unable to initialize WebGL. Your browser or machine may not support it.");this.controlBoxElm=document.getElementById("controlBox"),this.isControlsHidden=!0;const e=document.getElementById("canvas");this.asciiBoard=new s(e,t),this.isMuted=!0,this.setCanvasSize(20,20),this.attachEventListeners(),this.startSimpsons()}createVideoElement(){const t=document.createElement("video");return t.muted=!0,t.loop=!0,t.autoplay=!0,t.setAttribute("playsinline",!0),t.setAttribute("muted",!0),t.setAttribute("style","width: 1px; height: 1px; position: absolute"),document.body.appendChild(t),t}attachEventListeners(){document.getElementById("sizeSlider").addEventListener("change",t=>{this.asciiBoard.setSize(+t.target.value)}),document.addEventListener("scroll",()=>{this.moveVideo(window.pageXOffset,window.pageYOffset)}),document.getElementById("colorCheckbox").addEventListener("change",t=>{this.asciiBoard.setHasColor(t.target.checked)}),document.getElementById("muteCheckbox").addEventListener("change",t=>{this.mute(!t.target.checked)}),document.getElementById("videoSourceSimpsons").addEventListener("change",t=>{t.target.checked&&this.startSimpsons()}),document.getElementById("videoSourceWebcam").addEventListener("change",t=>{t.target.checked&&this.startWebcam()}),document.addEventListener("mousemove",()=>{this.showControlsBriefly()}),document.addEventListener("touchstart",()=>{this.showControlsBriefly()})}moveVideo(t,e){this.video.style.top=`${e+10}px`,this.video.style.left=`${t+10}px`}startSimpsons(){this.currentSource=a,this.setUpVideo(l)}startWebcam(){navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"environment"}}).then(t=>{var e=t.getVideoTracks();this.currentSource=c,this.setUpVideo(t,!0),console.log("video devices: ",e),console.log("Using video device: "+e[0].label),t.onremovetrack=function(){console.log("Stream ended")}}).catch((function(t){window.alert("Issue with webcam"),console.log(t)}))}setCanvasSize(t,e){const n=t/e,i=window.innerWidth,r=window.innerHeight,o=window.devicePixelRatio||1,s=r*n<i,a=Math.floor(s?r*n:i),c=Math.floor(s?r:i/n);this.canvas.width=a*o,this.canvas.height=c*o,this.canvas.style.height=`${c}px`,this.canvas.style.width=`${a}px`,this.asciiBoard.setViewport()}mute(t){this.isMuted=t,this.video.muted=t}showControlsBriefly(){if(this.isControlsHidden)return this.showControls(),void(this.hideControlsEvent=window.setTimeout(()=>{this.hideControls()},h));this.hideControlsEvent&&window.clearTimeout(this.hideControlsEvent),this.hideControlsEvent=window.setTimeout(()=>{this.hideControls()},h)}showControls(){console.log("showing controlls"),this.isControlsHidden=!1,this.controlBoxElm.classList.remove("hide")}hideControls(){console.log("hiding controlls"),this.isControlsHidden=!0,this.controlBoxElm.classList.add("hide")}setUpVideo(t,e=!1){const n=this.createVideoElement();this.video=n,this.cleanUpVideo&&this.cleanUpVideo();var i=!1;let r=!1,o=!1;e?n.srcObject=t:n.src=t;const s=()=>{i&&r&&!o&&(o=!0,n.muted=this.isMuted,this.setCanvasSize(n.videoWidth,n.videoHeight),this.asciiBoard.playVideo(n,e))},a=()=>{i=!0,s()},c=()=>{r=!0,s()};n.addEventListener("playing",a,!0),n.addEventListener("timeupdate",c,!0),this.cleanUpVideo=()=>{const t=n;console.log("cleaning up video"),this.asciiBoard.pauseVideo(),t.pause(),t.removeEventListener("playing",a,!0),t.removeEventListener("timeupdate",c,!0),document.body.removeChild(t)},n.play().then(()=>console.log("video playing")).catch(t=>console.log("error with video ",t))}}new u}]);